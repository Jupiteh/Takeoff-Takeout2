{"ast":null,"code":"var _jsxFileName = \"C:\\\\projet_web_avanc\\xE9\\\\client_template\\\\src\\\\pages\\\\testPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport axios from 'axios';\nimport 'leaflet/dist/leaflet.css';\nimport 'leaflet-routing-machine/dist/leaflet-routing-machine.css';\nimport 'leaflet-routing-machine';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction AnimatedMarker({\n  start,\n  end,\n  interval\n}) {\n  _s();\n  const [position, setPosition] = useState(start);\n  const [route, setRoute] = useState([]);\n  const map = useMap();\n  const markerRef = useRef(null);\n  const routingControlRef = useRef(null);\n  const deliveryId = 1; // Remplacez par l'ID de la livraison réelle\n\n  useEffect(() => {\n    if (!map) return;\n    routingControlRef.current = L.Routing.control({\n      waypoints: [L.latLng(start), L.latLng(end)],\n      createMarker: () => null // We create a custom marker\n    }).addTo(map);\n    routingControlRef.current.on('routesfound', function (e) {\n      const routes = e.routes[0].coordinates;\n      setRoute(routes);\n    });\n    return () => {\n      try {\n        if (routingControlRef.current) {\n          routingControlRef.current.getPlan().eachLayer(layer => {\n            if (layer && map.hasLayer(layer)) {\n              map.removeLayer(layer);\n            }\n          });\n          map.removeControl(routingControlRef.current);\n          routingControlRef.current = null;\n        }\n      } catch (error) {\n        console.error('Error while cleaning up routing control:', error);\n      }\n    };\n  }, [start, end, map]);\n  useEffect(() => {\n    if (route.length === 0) return;\n    let index = 0;\n    const intervalId = setInterval(async () => {\n      if (index >= route.length) {\n        clearInterval(intervalId);\n        alert('Le livreur est arrivé à destination!');\n      } else {\n        const newPosition = route[index];\n        setPosition(newPosition);\n        await updateDeliveryPosition(deliveryId, newPosition);\n        index += 1;\n      }\n    }, interval);\n    return () => clearInterval(intervalId);\n  }, [route, interval]);\n  const updateDeliveryPosition = async (deliveryId, position) => {\n    try {\n      await axios.put(`http://localhost:3005/api/deliveries/${deliveryId}`, {\n        latitude: position.lat,\n        longitude: position.lng\n      });\n    } catch (error) {\n      console.error('Error updating delivery position:', error);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(Marker, {\n    position: position,\n    ref: markerRef,\n    children: /*#__PURE__*/_jsxDEV(Popup, {\n      children: \"Delivery in progress\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 5\n  }, this);\n}\n_s(AnimatedMarker, \"pBFkHelAxOBhi4Ym/X6fryHIpBM=\", false, function () {\n  return [useMap];\n});\n_c = AnimatedMarker;\nfunction DeliveryTrackingPage() {\n  const start = [48.55445700, 7.68174900];\n  const end = [48.5823368, 7.7368053];\n  const interval = 100; // Adjust the interval value to change the speed\n\n  let DefaultIcon = L.icon({\n    iconUrl: \"https://unpkg.com/leaflet@1.6/dist/images/marker-icon.png\"\n  });\n  L.Marker.prototype.options.icon = DefaultIcon;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Delivery Tracking\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MapContainer, {\n      center: start,\n      zoom: 13,\n      scrollWheelZoom: true // Enable scroll wheel zoom\n      ,\n      style: {\n        height: \"600px\",\n        width: \"100%\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(TileLayer, {\n        attribution: \"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\",\n        url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(AnimatedMarker, {\n        start: start,\n        end: end,\n        interval: interval\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Marker, {\n        position: end,\n        children: /*#__PURE__*/_jsxDEV(Popup, {\n          children: \"Destination\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 5\n  }, this);\n}\n_c2 = DeliveryTrackingPage;\nexport default DeliveryTrackingPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"AnimatedMarker\");\n$RefreshReg$(_c2, \"DeliveryTrackingPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","MapContainer","TileLayer","Marker","Popup","useMap","L","axios","jsxDEV","_jsxDEV","AnimatedMarker","start","end","interval","_s","position","setPosition","route","setRoute","map","markerRef","routingControlRef","deliveryId","current","Routing","control","waypoints","latLng","createMarker","addTo","on","e","routes","coordinates","getPlan","eachLayer","layer","hasLayer","removeLayer","removeControl","error","console","length","index","intervalId","setInterval","clearInterval","alert","newPosition","updateDeliveryPosition","put","latitude","lat","longitude","lng","ref","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","DeliveryTrackingPage","DefaultIcon","icon","iconUrl","prototype","options","center","zoom","scrollWheelZoom","style","height","width","attribution","url","_c2","$RefreshReg$"],"sources":["C:/projet_web_avancé/client_template/src/pages/testPage.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport axios from 'axios';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport 'leaflet-routing-machine/dist/leaflet-routing-machine.css';\r\nimport 'leaflet-routing-machine';\r\n\r\nfunction AnimatedMarker({ start, end, interval }) {\r\n  const [position, setPosition] = useState(start);\r\n  const [route, setRoute] = useState([]);\r\n  const map = useMap();\r\n  const markerRef = useRef(null);\r\n  const routingControlRef = useRef(null);\r\n  const deliveryId = 1; // Remplacez par l'ID de la livraison réelle\r\n\r\n  useEffect(() => {\r\n    if (!map) return;\r\n\r\n    routingControlRef.current = L.Routing.control({\r\n      waypoints: [\r\n        L.latLng(start),\r\n        L.latLng(end)\r\n      ],\r\n      createMarker: () => null, // We create a custom marker\r\n    }).addTo(map);\r\n\r\n    routingControlRef.current.on('routesfound', function (e) {\r\n      const routes = e.routes[0].coordinates;\r\n      setRoute(routes);\r\n    });\r\n\r\n    return () => {\r\n      try {\r\n        if (routingControlRef.current) {\r\n          routingControlRef.current.getPlan().eachLayer(layer => {\r\n            if (layer && map.hasLayer(layer)) {\r\n              map.removeLayer(layer);\r\n            }\r\n          });\r\n          map.removeControl(routingControlRef.current);\r\n          routingControlRef.current = null;\r\n        }\r\n      } catch (error) {\r\n        console.error('Error while cleaning up routing control:', error);\r\n      }\r\n    };\r\n  }, [start, end, map]);\r\n\r\n  useEffect(() => {\r\n    if (route.length === 0) return;\r\n\r\n    let index = 0;\r\n    const intervalId = setInterval(async () => {\r\n      if (index >= route.length) {\r\n        clearInterval(intervalId);\r\n        alert('Le livreur est arrivé à destination!');\r\n      } else {\r\n        const newPosition = route[index];\r\n        setPosition(newPosition);\r\n        await updateDeliveryPosition(deliveryId, newPosition);\r\n        index += 1;\r\n      }\r\n    }, interval);\r\n\r\n    return () => clearInterval(intervalId);\r\n  }, [route, interval]);\r\n\r\n  const updateDeliveryPosition = async (deliveryId, position) => {\r\n    try {\r\n      await axios.put(`http://localhost:3005/api/deliveries/${deliveryId}`, {\r\n        latitude: position.lat,\r\n        longitude: position.lng,\r\n      });\r\n    } catch (error) {\r\n      console.error('Error updating delivery position:', error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Marker position={position} ref={markerRef}>\r\n      <Popup>Delivery in progress</Popup>\r\n    </Marker>\r\n  );\r\n}\r\n\r\nfunction DeliveryTrackingPage() {\r\n  const start = [48.55445700, 7.68174900];\r\n  const end = [48.5823368, 7.7368053];\r\n  const interval = 100; // Adjust the interval value to change the speed\r\n\r\n  let DefaultIcon = L.icon({\r\n    iconUrl: \"https://unpkg.com/leaflet@1.6/dist/images/marker-icon.png\",\r\n  });\r\n  L.Marker.prototype.options.icon = DefaultIcon;\r\n\r\n  return (\r\n    <div>\r\n      <h1>Delivery Tracking</h1>\r\n      <MapContainer\r\n        center={start}\r\n        zoom={13}\r\n        scrollWheelZoom={true} // Enable scroll wheel zoom\r\n        style={{ height: \"600px\", width: \"100%\" }}\r\n      >\r\n        <TileLayer\r\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n        />\r\n        <AnimatedMarker start={start} end={end} interval={interval} />\r\n        <Marker position={end}>\r\n          <Popup>Destination</Popup>\r\n        </Marker>\r\n      </MapContainer>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default DeliveryTrackingPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}